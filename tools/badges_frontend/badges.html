<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Badges</title>
  <link href="{{ static_url("bootstrap/css/bootstrap.min.css") }}" rel="stylesheet" />
  
  <style type="text/css">
    #badges-container { margin-top: 20px; }
    .table { margin-top: 50px; }
    #multiSelect { width: 350px; }
    .alert-success, .alert-error { width: 370px; margin-top: 20px; }
    .delete-badge-row, .edit-badge-row { width: 30px; }
  </style>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="{{ static_url("bootstrap/js/bootstrap.min.js") }}"></script>
  <script type="text/javascript">
    $(function() {
      $("#add-new-button").click(function() {
        $(".alert").hide();
        $("#add-new-form").toggle('slow');
        return false;
      });
      $("#add-new-cancel").click(function() {
        $("#add-new-form").hide('slow');
        return false;
      });
      $(".table tr").hover(
        function () {
          $(this).find(".btn-danger, .btn-inverse").toggle();
        },
        function () {
          $(this).find(".btn-danger, .btn-inverse").toggle();
        }
      );
      $(".btn-delete-badge").click(function() {
        bid = "bid-" + $(this).attr("id").slice(4);
        $("#delete-badge-modal .btn-delete-badge-confirm").attr("id", bid);
        $('#delete-badge-modal').modal('show');
        return false;
      });
      $(".btn-delete-badge-confirm").click(function() {
        bid = $(this).attr("id").slice(4);
        $.get('/badges/delete/' + bid, function(data) {
          window.location = "/";
        });
        $('#delete-badge-modal').modal('hide');
        return false;
      });
    });
  </script>
</head>
<body>
  <div class="container">
    <div class="row" id="badges-container">
      <div class="navbar">
        <div class="navbar-inner">
          <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>
            <a class="brand" href="/">Egg Badges</a>
            <div class="nav-collapse">
              <ul class="nav">
                <li class="active"><a href="/">Home</a></li>
                <li><a href="#" id="add-new-button">Add New</a></li>
              </ul>
            </div><!-- /.nav-collapse -->
          </div>
        </div><!-- /navbar-inner -->
      </div>
        
      {% if added_new %}
      <div class="alert alert-success">
        <button type="button" class="close" data-dismiss="alert">×</button>
        <strong>Well done!</strong> You successfully added new badge!
      </div>
      {% end %}
      {% if error %}
      <div class="alert alert-error">
        <button type="button" class="close" data-dismiss="alert">×</button>
        <strong>Oh snap!</strong> Change a few things up and try again.
      </div>
      {% end %}
      
      <form name="add-new" method="post" action="/badges/add" enctype="multipart/form-data" class="form-horizontal hide" id="add-new-form">
        <fieldset>
          <div class="control-group">
            <label class="control-label" for="input01">Name</label>
            <div class="controls">
              <input name="name" type="text" class="input-xlarge" id="input01">
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="textarea">Description</label>
            <div class="controls">
              <textarea name="description" class="input-xlarge" id="textarea" rows="3"></textarea>
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="select01">Parent</label>
            <div class="controls">
              <select name="parent" id="select01">
                <option value="0">-- root</option>
                {% for badge in badges %}
                  <option value="{{ badge.badge_id }}">{{ badge.name }}</option>
                {% end %}
              </select>
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="multiSelect">Type</label>
            <div class="controls">
              <select name="type" size="4" id="multiSelect">
                <option value="1">(1) not important - children important - only one child</option>
                <option value="2">(2) important - no children</option>
                <option value="3">(3) important - children</option>
                <option value="4">(4) not important - children important - multiple children</option>
              </select>
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="fileInput">Image</label>
            <div class="controls">
              <input name="image" class="input-file" id="fileInput" type="file">
            </div>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary add-new-submit">Save changes</button>
            <button class="btn" id="add-new-cancel">Cancel</button>
          </div>
        </fieldset>
      </form>
        
      {% if len(badges) is 0 %}
        <p>No badges in database.</p>
      {% else %}
        <table class="table table-striped">
          <thead>
            <tr>
              <th>badgeID</th>
              <th>name</th>
              <th>thumbnail</th>
              <th>description</th>
              <th>parent</th>
              <th>type</th>
              <!--<th class="edit-badge-row"></th>-->
              <th class="delete-badge-row"></th>
            </tr>
          </thead>
          <tbody>
            {% for badge in badges %}
              <tr>
                <td>{{ badge.badge_id }}</td>
                <td>{{ badge.name }}</td>
                <td>{{ badge.link }}</td>
                <td>{{ badge.description }}</td>
                <td>{{ badge.parent }}</td>
                <td>{{ badge.type }}</td>
                <!--<td><a class="btn btn-inverse btn-edit-badge hide" href="#" title="Edit badge"><i class="icon-edit icon-white"></i></a></td>-->
                <td><a class="btn btn-danger btn-delete-badge hide" title="Delete badge" id="bid-{{ badge.badge_id }}"><i class="icon-trash icon-white"></i></a></td>
              </tr>
            {% end %}
          </tbody>
        </table>
      {% end %}
    </div>
  </div>
  
  <div class="modal hide" id="delete-badge-modal">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal">×</button>
      <h3>Warning:</h3>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to delete this badge? This action cannot be reverted.</p>
    </div>
    <div class="modal-footer">
      <a href="#" class="btn" data-dismiss="modal">Cancel</a>
      <a href="#" class="btn btn-danger btn-delete-badge-confirm"><i class="icon-trash icon-white"></i> Delete</a>
    </div>
  </div>
</body>
</html>
